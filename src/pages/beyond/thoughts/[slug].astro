---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';

// Generate static paths for all thoughts
export async function getStaticPaths() {
	const thoughts = await getCollection('thoughts');
	return thoughts.map(thought => ({
		params: { slug: thought.id },
		props: { entry: thought }
	}));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---

<BaseLayout title={entry.data.title} description={entry.data.excerpt}>
	<div class="stack gap-20 lg:gap-48">
		<div class="wrapper stack gap-8 lg:gap-20">
			<header class="post-header">
				<div class="breadcrumb">
					<a href={`${import.meta.env.BASE_URL}beyond/thoughts/`}>‚Üê Back to Thoughts</a>
				</div>

				<span class="post-date">{entry.data.date}</span>
				<h1 class="post-title">{entry.data.title}</h1>
				<p class="post-subtitle">{entry.data.excerpt}</p>
			</header>

			<main class="post-content">
				<div class="content-section">
					<Content />
				</div>

				{entry.data.tags && entry.data.tags.length > 0 && (
					<div class="meta-section">
						<div class="tags">
							{entry.data.tags.map(tag => (
								<span class="tag">{tag}</span>
							))}
						</div>
					</div>
				)}
			</main>
		</div>
	</div>
</BaseLayout>

<script>
	// Smart back button: go to referring page if from same site, otherwise fallback to thoughts list
	const backLink = document.querySelector('.breadcrumb a');
	if (backLink) {
		backLink.addEventListener('click', (e) => {
			const referrer = document.referrer;
			const currentDomain = window.location.origin;

			// If user came from somewhere on our site, go back in history
			if (referrer && referrer.startsWith(currentDomain)) {
				e.preventDefault();
				window.history.back();
			}
			// Otherwise, let the default href handle it (goes to /beyond/thoughts/)
		});
	}
</script>
